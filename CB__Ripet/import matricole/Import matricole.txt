Creata cartella CUSTOM/tmpExtraction

Creato file CUSTOM/filecopy.bat ->
@echo off
copy /Y "%~1" "%~2"

---------------------------------------------------------------------------------------------------------------------------------

Modulo PrdPrzListPromo Indice 0 ->

Intestazione Grid :
(5)[inform2.gif,10]PREMERE F10 per attivare/disattivare il filtro le sole matricole ancora da utilizzare (quindi Tipo diverso da 'OPERATIVO' e 'NASCOSTO').
PREMERE F11 per importare una lista di matricole da file CSV (strutturato 'codice prodotto';'matricola').

Ogni matricola deve essere associata al Riparatore/Fornitore che la gestisce

Script Eventi:
<onkeyf10>
<![CDATA[
Dim iAvailableOnly = FormInfoGet("AvailableOnly", 0)
If iAvailableOnly = 1 Then
	iAvailableOnly = 0
Else
	iAvailableOnly = 1
EndIf
FormInfoSet("AvailableOnly", iAvailableOnly, 0, True)
DataRebind(0, False)
'DataRefresh(0, False)
]]>
</onkeyf10>
<onkeyf11>
<![CDATA[
Dim bOk = True
Dim sMsg$ = ""
Dim sSql$ = ""
Dim sFilePath$ = ""
Dim sCmd$ = ""
Dim sExtractionRes$ = ""
Dim iElabNumber =  DbRead("Select DateDiff(second, '1970-01-01', GetDate()) 'Res'")
'Dim sFileCopyPath$ = "\\server-ripet\BEEP\CUSTOM\filecopy.bat"
Dim sFileCopyPath$ = "C:\RIPRISTINO-BEEP\beep-ripet\CUSTOM\filecopy.bat"
Dim iSession = AppInfoGet("Session")

If bOk Then
	sFilePath$ = FileOpen("", "", "File CSV (*.csv)|*.csv", "")
	bOk = (Len(sFilePath$) > 0)
	If bOk = False Then
		MsgBox "Errore! Nessun file CSV selezionato"
	EndIf
EndIf

If bOk Then
	sSql$ = "Select dbo.[udfPrepareFileCopy_Pers] ('" & sFilePath$ & "', " & iElabNumber.ToString() & ")"
	sCmd$ = DbRead(sSql$)
	bOk = RunProcess(sFileCopyPath$, sCmd$, 3, True)
	
	If bOk = False Then
		MsgBox "Errore! La copia del file nella cartella di lavoro non Ã¨ andata a buon fine. Verificare connessione di rete e accensione del server"
	EndIf
EndIf

If bOk Then
	'sSql$ = "dbo.[uspLaunchCsvExtractor_Pers] " + iSession + ", 'D:\\BEEP\CUSTOM\tmpExtraction\" & iElabNumber.ToString() & ".csv'"
	sSql$ = "dbo.[uspLaunchCsvExtractor_Pers] " + iSession + ", 'C:\RIPRISTINO-BEEP\beep-ripet\CUSTOM\tmpExtraction\" & iElabNumber.ToString() & ".csv'"
	sMsg$ = DbRead(sSql$)
	
	If sMsg$ = "OK" Then
		MsgOk "Import completato!"
	Else Then
		MsgOk sMsg$
	Endif
EndIf

If bOk Then
	DataRefresh(0, False, 0)
EndIf

MouseWait(False)
]]>
</onkeyf11>
<onupdate>
<![CDATA[
MouseWait(True)
Dim sPrdCod$ = ValueGet("PrdCod")
Dim sPrdSerial$ = ValueGet("PrdSerial")
If (sPrdCod$ <> "") And (sPrdSerial$ = "") Then
	Dim sItemNex$ = DbRead("dbo.[uspPrdSerial_next]", "", sPrdCod$)
	ValueSet("PrdSerial", sItemNex$)
EndIf
MouseWait(False)
]]>
</onupdate>
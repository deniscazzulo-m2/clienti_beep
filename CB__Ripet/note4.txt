IvaRegCod = A1 = @1$

uspDD_build_CntReg 259

uspDoc_Save


Ripristino:
[Attach] NO
[CliDoc] NO
[CntPay] NO
[CntReg] => MovDtaCptIva, PagStart
[CntRegLin] NO
[CntRegMod] NO
[CntRegModLin] NO
[CntRegPar] NO
[CntRegRecuperaPNum2] NO --?
[CntRegRiba] NO
[IvaElab]
[IvaElabCheck] NO
[IvaElabLin] => MovDtaCptIva
[IvaElabReg] NO
[IvaElabRegPayed] NO
[IvaElabRegTotal] NO
[IvaReg] NO
[IvaRegProNum] NO
[IvaRegProNumDeleted] NO --?
[IvaTab] NO
[RibaElabHistory] NO



select B.MovDtaCptIva, A.MovDtaCptIva, B.PagStart, A.PagStart from [BpRIPET].dbo.[CntReg] A
join [BpDatiDaRipristinare].dbo.[CntReg] B
on A.Uniq = B.Uniq


Dati Scorretti:
select A.Uniq, A.IvaRegCod, A.MovDocNum, A.MovDta, A.MovDtaCptIva, B.MovDtaCptIva, A.PagStart, B.PagStart 
from [BpRIPET].dbo.[CntReg] A 
join [BpDatiDaRipristinare].dbo.[CntReg] B
on A.Uniq = B.Uniq
where A.MovDtaCptIva<>B.MovDtaCptIva OR A.PagStart <> B.PagStart
order by A.Uniq

select A.UniqRow, A.IvaRegCod, A.DocNum, A.DocDta, A.MovDtaCptIva, B.MovDtaCptIva
from [BpRIPET].dbo.[IvaElabLin] A 
join [BpDatiDaRipristinare].dbo.[IvaElabLin] B
on A.UniqRow = B.UniqRow
where A.MovDtaCptIva<>B.MovDtaCptIva
order by A.UniqRow




Istruzione Ripristino:
UPDATE [BpRIPET].dbo.[CntReg] set
[BpRIPET].dbo.[CntReg].MovDtaCptIva = ISNULL(B.MovDtaCptIva, A.MovDtaCptIva),
[BpRIPET].dbo.[CntReg].PagStart = ISNULL(B.PagStart, A.PagStart)
from [BpRIPET].dbo.[CntReg] A
join [BpDatiDaRipristinare].dbo.[CntReg] B
on A.Uniq = B.Uniq


UPDATE [BpRIPET].dbo.[IvaElabLin] set
[BpRIPET].dbo.[IvaElabLin].MovDtaCptIva = ISNULL(B.MovDtaCptIva, A.MovDtaCptIva)
from [BpRIPET].dbo.[IvaElabLin] A
join [BpDatiDaRipristinare].dbo.[IvaElabLin] B
on A.UniqRow = B.UniqRow

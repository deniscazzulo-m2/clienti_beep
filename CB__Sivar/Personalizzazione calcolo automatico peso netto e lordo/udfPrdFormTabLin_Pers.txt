/*
*
*
*/
CREATE FUNCTION [dbo].[udfPrdFormTabLin_Pers]
(
	@iSession int,
	@sTabCod varchar(32)
)
RETURNS @tbPrdFormTabLin TABLE( 
	[ItemID] varchar(32) NULL,
	[Peso] decimal(9, 3) NULL,
	[ItemDes] nvarchar(512) NULL,
	[PrdAdd] char(1) NULL, 
	[LinNum] smallint NULL
)
AS
BEGIN
Declare @sLanguage varchar(8) = dbo.[udfSysLanguage](@iSession)

INSERT @tbPrdFormTabLin
Select
	A.ItemID,
	Peso,
	'ItemDes' = Case When @sLanguage <> 'ITA' And IsNull(B.ItemText1, '') <> '' Then B.ItemText1 Else A.ItemDes End,
	PrdAdd, LinNum
From dbo.[PrdFormTabLin] A
Left Join dbo.[udfPrdFormLocText]('PrdFormTabLin', @sLanguage) B On B.ItemName1 = A.TabCod And B.ItemName2 = A.ItemID
Left Join dbo.[PrdFormTabLinEx_Pers] C On A.TabCod = C.TabCod And A.ItemID = C.ItemID
Where A.TabCod = @sTabCod

RETURN
END
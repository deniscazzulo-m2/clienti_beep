/*
*
*
*
*/
CREATE TRIGGER [dbo].[trgPrdFormTabLin_OnUpdate]
ON [dbo].[PrdFormTabLin]
FOR UPDATE
AS
Declare @sTabCod1 [varchar](32)
Declare @sTabCod2 [varchar](32)
Declare @sItemID1 [varchar](32)
Declare @sItemID2 [varchar](32)

SET NOCOUNT ON
If Update(TabCod) Or Update(ItemID)
	Begin
		IF ISNULL((SELECT TOP 1 1 [TabCod] From dbo.[PrdFormTab] WHERE [TabCod] = (SELECT [TabCod] FROM inserted)),0) = 0
			INSERT dbo.[PrdFormTab]([TabCod],[TabDes])
			SELECT [TabCod], CONCAT('Nuovo elenco colori per ',dbo.[udfStrReplacePattern]([TabCod],'ยง%',''))
			From inserted
	
		Select @sTabCod1 = TabCod, @sItemID1 = ItemID From Deleted
		Select @sTabCod2 = TabCod, @sItemID2 = ItemID From Inserted

		Update dbo.[PrdFormLocTexts] Set
			ItemName1 = @sTabCod2, 
			ItemName2 = @sItemID2
		Where TableID = 'PrdFormTabLin'
			And ItemName1 = @sTabCod1
			And ItemName2 = @sItemID1			
	End
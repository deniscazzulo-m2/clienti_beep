/*
*
*	Ritorna sotto forma di tabella 
*	tutti i dati della testata di un documento di vendita/acquisto
*
*/
CREATE FUNCTION [dbo].[udfDD_Head]
(
	@iDocTip tinyint,
	@iDocUniq int
)
RETURNS @TableHead TABLE( 
	[DocTip] tinyint NULL,
	[DocNum] varchar(32) NULL,
	[DocDta] date NULL,
	[DocOra] varchar(16) NULL,
	[DocKind] tinyint NULL,
	[DocStatus] tinyint NULL,
	[AnaType] tinyint NULL,
	[AnaCod] varchar(16) NULL,
	[AnaCodFrom] varchar(16) NULL,
	[DsmCod] varchar(16) NULL,
	[MndCod] varchar(16) NULL,
	[ForDocNum] varchar(32) NULL,
	[ForDocDta] date NULL,
	[VsRif] varchar(64) NULL,
	[NsRif] varchar(64) NULL,
	[NumExt] varchar(64) NULL,
	[DocRif] varchar(64) NULL,
	[Info] varchar(1024) NULL,
	[SendDta] date NULL,
	[SendWay] varchar(32) NULL,
	[SendInfo] varchar(256) NULL,
	[CnsDta] date NULL,
	[CnsWeek] tinyint NULL,
	[CnsInfo] varchar(256) NULL,
	[DocTot] decimal(19, 2) NULL,
	[DocImp] decimal(19, 2) NULL,
	[DocIva] decimal(19, 2) NULL,
	[DocOmg] decimal(19, 2) NULL,
	[DocMerce] decimal(19, 2) NULL,
	[DocSconti] decimal(19, 2) NULL,
	[DocSpese] decimal(19, 2) NULL,
	[PagStart] date NULL,
	[PagCod] varchar(16) NULL,
	[AgeCod] varchar(16) NULL,
	[PrvSplitCod] varchar(16) NULL,
	[PrvFix] decimal(9, 2) NULL,
	[PrvTot] decimal(19, 2) NULL,
	[LstCod] varchar(32) NULL,
	[LstSconti] varchar(16) NULL,
	[ShipPayCod] varchar(8) NULL,
	[ShipCod] varchar(8) NULL,
	[VetCod] varchar(16) NULL,
	[VetCod2] varchar(16) NULL,
	[SctTotPc] decimal(9, 2) NULL,
	[SctTot] decimal(19, 6) NULL,
	[SctPagPc] decimal(9, 2) NULL,
	[SctPag] decimal(19, 2) NULL,
	[SpImballo] decimal(9, 2) NULL,
	[SpTra] decimal(9, 2) NULL,
	[SpRiba] decimal(9, 2) NULL,
	[SpBolli] decimal(9, 2) NULL,
	[SpVarie] decimal(9, 2) NULL,
	[Lotto] varchar(32) NULL,
	[Fornitura] int NULL,
	[RapUniq] int NULL,
	[Packing] int NULL,
	[TrMezzo] tinyint NULL,
	[TrPorto] tinyint NULL,
	[Colli] smallint NULL,
	[EmiCau] varchar(32) NULL,
	[AspBeni] varchar(64) NULL,
	[Imballo] varchar(64) NULL,
	[Peso] decimal(9, 3) NULL,
	[PesoNetto] decimal(9, 3) NULL,
	[Volume] decimal(19, 6) NULL,
	[DtaRitM] date NULL,
	[OraRitM] varchar(16) NULL,
	[SegueFt] bit NULL,
	[VetComp] decimal(19, 2) NULL,
	[Info1] varchar(64) NULL,
	[Info2] varchar(64) NULL,
	[Info3] varchar(64) NULL,
	[Info4] varchar(64) NULL,
	[Info5] varchar(64) NULL,
	[Info6] varchar(64) NULL,
	[DocIvaCod] varchar(8) NULL,
	[Divisa] varchar(8) NULL,
	[Cambio] decimal(19, 6) NULL,
	[CambioDta] date NULL,
	[CntRegMod] varchar(8) NULL,
	[CntRegDta] date NULL,
	[CntRegDtaIva] date NULL,
	[MagMovMod] varchar(8) NULL,
	[MagMovMod2] varchar(8) NULL,
	[MagMovDta] date NULL,
	[NumCod] varchar(8) NULL,
	[Numero] int NULL,
	[Uniq] int NULL,
	[Uniq2] int NULL,
	[RecCreate] date NULL,
	[RecUserID] smallint NULL,
	[RecCompany] tinyint NULL,
	[RecAgency] tinyint NULL,
	[RecLocked] bit NULL,
	[RecPrinted] bit NULL,
	[RecType] tinyint NULL,
	[RecElabID] int NULL,
	[RecValue] decimal(19, 6) NULL,
	[RecMaster] int NULL
	,
	[CaPre] int NULL
	)
AS
BEGIN
	Declare @sTableID varchar(64) = dbo.[udfDocTip_TableID](@iDocTip)
	If @sTableID = 'CliOff'
	Begin
		INSERT @TableHead
		Select A.*, B.CaPre
		From dbo.[CliOff] A Left Join dbo.[CliOffEx_Pers] B 
		On A.Uniq = B.Uniq
		Where A.Uniq = @iDocUniq
	End

	Else If @sTableID = 'CliOrd'
	Begin
		INSERT @TableHead
		Select A.*, B.CaPre
		From dbo.[CliOrd] A Left Join dbo.[CliOrdEx_Pers] B 
		On A.Uniq = B.Uniq
		Where A.Uniq = @iDocUniq
	End

	Else If @sTableID = 'CliDoc'
	Begin
		INSERT @TableHead
		Select A.*, B.CaPre
		From dbo.[CliDoc] A Left Join dbo.[CliDocEx_Pers] B 
		On A.Uniq = B.Uniq
		Where A.DocTip = @iDocTip
			And A.Uniq = @iDocUniq
	End

	Else If @sTableID = 'ForOff'
	Begin
		INSERT @TableHead
		Select *, null
		From dbo.[ForOff]
		Where Uniq = @iDocUniq
	End
	
	Else If @sTableID = 'ForOrd'
	Begin
		INSERT @TableHead
		Select *, null
		From dbo.[ForOrd]
		Where Uniq = @iDocUniq
	End
	
	Else If @sTableID = 'ForDoc'
	Begin
		INSERT @TableHead
		Select *, null
		From dbo.[ForDoc]
		Where DocTip = @iDocTip
			And Uniq = @iDocUniq
	End

	Else If @sTableID = 'BasketDoc'
	Begin
		INSERT @TableHead
		Select *, null
		From dbo.[BasketDoc]
		Where Uniq = @iDocUniq
	End
		
	RETURN
END
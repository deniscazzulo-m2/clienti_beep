/*
*
*
*
*/
CREATE TRIGGER [dbo].[trgCliOff_OnDelete]
ON [dbo].[CliOff]
FOR DELETE
AS
SET NOCOUNT ON
Declare @iDocTip tinyint = 10
Declare @sAttachFrom varchar(32) = dbo.[udfAttachFrom](@iDocTip, 0)

Delete dbo.[CliOffPar]
Where UniqDoc In(Select Uniq From deleted)

Delete dbo.[CliOffLin]
Where UniqDoc In(Select Uniq From deleted)

Delete dbo.[CliOffEx_Pers]
Where (Uniq In(Select Uniq From deleted))

--Delete dbo.[MagMov]
--Where Uniq In(
--	Select DISTINCT UniqMov
--	From dbo.[MagMovLin]
--	Where (DocTipFrom = @iDocTip)
--		And (UniqFrom In(Select Uniq From deleted))
--	)

Delete dbo.[Attach]
Where AttachFrom = @sAttachFrom
	And (DocID In(Select Cast(Uniq As varchar(32)) From deleted))
	And (DocTip = @iDocTip)